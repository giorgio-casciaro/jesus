'use strict';

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var R = require('ramda');
var fs = require('fs');
var path = require('path');
var deref = require('json-schema-deref-sync');
var normalise = require('ajv-error-messages');
var ajv = require('ajv')({ allErrors: true });
var LOG = console;
var sourceMapSupport = require('source-map-support');
sourceMapSupport.install();

module.exports = {
  getAllServicesConfigFromDir: function getAllServicesConfigFromDir(dir) {
    var fileName = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'api.json';

    var services = {};
    fs.readdirSync(dir).forEach(function (file) {
      var filePath = path.join(dir, file, fileName);
      if (fs.existsSync(filePath)) services[file] = require(filePath);
    });
    // LOG.debug("getAllServicesConfigFromDir",services)
    return services;
  },
  validateApiFromConfig: function validateApiFromConfig(apiConfigFile, apiMethod, data, schemaField) {
    // TO FIX ADD CACHE
    var apiConfigPath = path.dirname(apiConfigFile) + '/';
    var apiConfig = require(apiConfigFile);
    if (!apiConfig || !apiConfig[apiMethod] || !apiConfig[apiMethod][schemaField]) throw 'Api validation problem :' + apiMethod + ' ' + schemaField + ' in ' + apiConfigFile;
    var schema = deref(apiConfig[apiMethod][schemaField], { baseFolder: apiConfigPath, failOnMissing: true });
    LOG.debug('validateApiFromConfig schema', apiConfig, apiMethod, schemaField, apiConfigPath, schema);
    var validate = ajv.compile(schema);
    var valid = validate(data);

    if (!valid) {
      LOG.debug('validate.errors', normalise(validate.errors));
      throw normalise(validate.errors);
    }
    return data;
  },

  getAsPromise: function getAsPromise(value) {
    return new Promise(function (resolve, reject) {
      Promise.resolve(value).then(function (value) {
        if (typeof value === 'function') {
          try {
            resolve(value());
          } catch (error) {
            reject(error);
          }
        } else resolve(value);
      });
    });
  },
  argsOverwrite: function argsOverwrite() {
    var overwriteArgs = Array.prototype.slice.call(arguments, 1);
    var originalPackage = arguments[0];
    var modifiedPackage = {};
    for (var i in originalPackage) {
      modifiedPackage[i] = function packageArgsOverwrite() {
        var modifiedArguments = Object.assign(arguments, overwriteArgs);
        return originalPackage[i].apply(this, modifiedArguments);
      };
    }
    return modifiedPackage;
  },
  checkRequired: function checkRequired(PROPS_OBJ, PACKAGE) {
    var propsNames = Object.keys(PROPS_OBJ);
    propsNames.forEach(function (propName) {
      if (!PROPS_OBJ[propName]) {
        throw new Error('PACKAGE ' + PACKAGE + ' -> Required Dependency ' + propName + ' is missing');
      }
    });
  },
  isEmptyArray: function isEmptyArray(array) {
    return !array || !array.length;
  },

  addObjectColumn: function addObjectColumn(objectsArray, columnName, valuesArray) {
    var addColums = function addColums(val, index) {
      return R.merge(_defineProperty({}, columnName, valuesArray[index]), val);
    };
    return R.addIndex(R.map)(addColums, objectsArray);
  }

};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImplc3VzLmVzNiJdLCJuYW1lcyI6WyJSIiwicmVxdWlyZSIsImZzIiwicGF0aCIsImRlcmVmIiwibm9ybWFsaXNlIiwiYWp2IiwiYWxsRXJyb3JzIiwiTE9HIiwiY29uc29sZSIsInNvdXJjZU1hcFN1cHBvcnQiLCJpbnN0YWxsIiwibW9kdWxlIiwiZXhwb3J0cyIsImdldEFsbFNlcnZpY2VzQ29uZmlnRnJvbURpciIsImRpciIsImZpbGVOYW1lIiwic2VydmljZXMiLCJyZWFkZGlyU3luYyIsImZvckVhY2giLCJmaWxlUGF0aCIsImpvaW4iLCJmaWxlIiwiZXhpc3RzU3luYyIsInZhbGlkYXRlQXBpRnJvbUNvbmZpZyIsImFwaUNvbmZpZ0ZpbGUiLCJhcGlNZXRob2QiLCJkYXRhIiwic2NoZW1hRmllbGQiLCJhcGlDb25maWdQYXRoIiwiZGlybmFtZSIsImFwaUNvbmZpZyIsInNjaGVtYSIsImJhc2VGb2xkZXIiLCJmYWlsT25NaXNzaW5nIiwiZGVidWciLCJ2YWxpZGF0ZSIsImNvbXBpbGUiLCJ2YWxpZCIsImVycm9ycyIsImdldEFzUHJvbWlzZSIsInZhbHVlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJ0aGVuIiwiZXJyb3IiLCJhcmdzT3ZlcndyaXRlIiwib3ZlcndyaXRlQXJncyIsIkFycmF5IiwicHJvdG90eXBlIiwic2xpY2UiLCJjYWxsIiwiYXJndW1lbnRzIiwib3JpZ2luYWxQYWNrYWdlIiwibW9kaWZpZWRQYWNrYWdlIiwiaSIsInBhY2thZ2VBcmdzT3ZlcndyaXRlIiwibW9kaWZpZWRBcmd1bWVudHMiLCJPYmplY3QiLCJhc3NpZ24iLCJhcHBseSIsImNoZWNrUmVxdWlyZWQiLCJQUk9QU19PQkoiLCJQQUNLQUdFIiwicHJvcHNOYW1lcyIsImtleXMiLCJwcm9wTmFtZSIsIkVycm9yIiwiaXNFbXB0eUFycmF5IiwiYXJyYXkiLCJsZW5ndGgiLCJhZGRPYmplY3RDb2x1bW4iLCJvYmplY3RzQXJyYXkiLCJjb2x1bW5OYW1lIiwi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YUFBZ0I5RSxFQUFFK0UsS0FBRixxQkFDN0JMLFVBRDZCLEVBQ2hCQyxZQUFZRyxLQUFaLENBRGdCLEdBRTdCRCxHQUY2QixDQUFoQjtBQUFBLEtBQWhCO0FBR0EsV0FBTzdFLEVBQUVnRixRQUFGLENBQVdoRixFQUFFaUYsR0FBYixFQUFrQkwsU0FBbEIsRUFBNkJILFlBQTdCLENBQVA7QUFDRDs7QUFoRWMsQ0FBakIiLCJmaWxlIjoiamVzdXMuZXM2Iiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgUiA9IHJlcXVpcmUoJ3JhbWRhJylcbmNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKVxuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKVxudmFyIGRlcmVmID0gcmVxdWlyZSgnanNvbi1zY2hlbWEtZGVyZWYtc3luYycpXG52YXIgbm9ybWFsaXNlID0gcmVxdWlyZSgnYWp2LWVycm9yLW1lc3NhZ2VzJylcbnZhciBhanYgPSByZXF1aXJlKCdhanYnKSh7YWxsRXJyb3JzOiB0cnVlfSlcbnZhciBMT0cgPSBjb25zb2xlXG52YXIgc291cmNlTWFwU3VwcG9ydCA9IHJlcXVpcmUoJ3NvdXJjZS1tYXAtc3VwcG9ydCcpXG5zb3VyY2VNYXBTdXBwb3J0Lmluc3RhbGwoKVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgZ2V0QWxsU2VydmljZXNDb25maWdGcm9tRGlyIChkaXIsIGZpbGVOYW1lID0gJ2FwaS5qc29uJykge1xuICAgIHZhciBzZXJ2aWNlcyA9IHt9XG4gICAgZnMucmVhZGRpclN5bmMoZGlyKS5mb3JFYWNoKGZpbGUgPT4ge1xuICAgICAgY29uc3QgZmlsZVBhdGggPSBwYXRoLmpvaW4oZGlyLCBmaWxlLCBmaWxlTmFtZSlcbiAgICAgIGlmIChmcy5leGlzdHNTeW5jKGZpbGVQYXRoKSlzZXJ2aWNlc1tmaWxlXSA9IHJlcXVpcmUoZmlsZVBhdGgpXG4gICAgfSlcbiAgICAvLyBMT0cuZGVidWcoXCJnZXRBbGxTZXJ2aWNlc0NvbmZpZ0Zyb21EaXJcIixzZXJ2aWNlcylcbiAgICByZXR1cm4gc2VydmljZXNcbiAgfSxcblxuICB2YWxpZGF0ZUFwaUZyb21Db25maWcgKGFwaUNvbmZpZ0ZpbGUsIGFwaU1ldGhvZCwgZGF0YSwgc2NoZW1hRmllbGQgKSB7XG4gICAgICAvLyBUTyBGSVggQUREIENBQ0hFXG4gICAgdmFyIGFwaUNvbmZpZ1BhdGggPSBwYXRoLmRpcm5hbWUoYXBpQ29uZmlnRmlsZSkgKyAnLydcbiAgICB2YXIgYXBpQ29uZmlnID0gcmVxdWlyZShhcGlDb25maWdGaWxlKVxuICAgIGlmKCFhcGlDb25maWd8fCFhcGlDb25maWdbYXBpTWV0aG9kXXx8IWFwaUNvbmZpZ1thcGlNZXRob2RdW3NjaGVtYUZpZWxkXSl0aHJvdyBgQXBpIHZhbGlkYXRpb24gcHJvYmxlbSA6JHthcGlNZXRob2R9ICR7c2NoZW1hRmllbGR9IGluICR7YXBpQ29uZmlnRmlsZX1gXG4gICAgdmFyIHNjaGVtYSA9IGRlcmVmKGFwaUNvbmZpZ1thcGlNZXRob2RdW3NjaGVtYUZpZWxkXSwge2Jhc2VGb2xkZXI6IGFwaUNvbmZpZ1BhdGgsIGZhaWxPbk1pc3Npbmc6IHRydWV9KVxuICAgIExPRy5kZWJ1ZygndmFsaWRhdGVBcGlGcm9tQ29uZmlnIHNjaGVtYScsIGFwaUNvbmZpZywgYXBpTWV0aG9kLCBzY2hlbWFGaWVsZCwgYXBpQ29uZmlnUGF0aCwgc2NoZW1hKVxuICAgIHZhciB2YWxpZGF0ZSA9IGFqdi5jb21waWxlKHNjaGVtYSlcbiAgICB2YXIgdmFsaWQgPSB2YWxpZGF0ZShkYXRhKVxuXG4gICAgaWYgKCF2YWxpZCkge1xuICAgICAgTE9HLmRlYnVnKCd2YWxpZGF0ZS5lcnJvcnMnLCBub3JtYWxpc2UodmFsaWRhdGUuZXJyb3JzKSlcbiAgICAgIHRocm93IG5vcm1hbGlzZSh2YWxpZGF0ZS5lcnJvcnMpXG4gICAgfVxuICAgIHJldHVybiBkYXRhXG4gIH0sXG4gIGdldEFzUHJvbWlzZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiAodmFsdWUpID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgdHJ5IHsgcmVzb2x2ZSh2YWx1ZSgpKSB9IGNhdGNoIChlcnJvcikgeyByZWplY3QoZXJyb3IpIH1cbiAgICAgICAgfSBlbHNlIHJlc29sdmUodmFsdWUpXG4gICAgICB9KVxuICAgIH0pXG4gIH0sXG4gIGFyZ3NPdmVyd3JpdGUgKCkge1xuICAgIHZhciBvdmVyd3JpdGVBcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKVxuICAgIHZhciBvcmlnaW5hbFBhY2thZ2UgPSBhcmd1bWVudHNbMF1cbiAgICB2YXIgbW9kaWZpZWRQYWNrYWdlID0ge31cbiAgICBmb3IgKHZhciBpIGluIG9yaWdpbmFsUGFja2FnZSkge1xuICAgICAgbW9kaWZpZWRQYWNrYWdlW2ldID0gZnVuY3Rpb24gcGFja2FnZUFyZ3NPdmVyd3JpdGUgKCkge1xuICAgICAgICB2YXIgbW9kaWZpZWRBcmd1bWVudHMgPSBPYmplY3QuYXNzaWduKGFyZ3VtZW50cywgb3ZlcndyaXRlQXJncylcbiAgICAgICAgcmV0dXJuIG9yaWdpbmFsUGFja2FnZVtpXS5hcHBseSh0aGlzLCBtb2RpZmllZEFyZ3VtZW50cylcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG1vZGlmaWVkUGFja2FnZVxuICB9LFxuICBjaGVja1JlcXVpcmVkIChQUk9QU19PQkosIFBBQ0tBR0UpIHtcbiAgICB2YXIgcHJvcHNOYW1lcyA9IE9iamVjdC5rZXlzKFBST1BTX09CSilcbiAgICBwcm9wc05hbWVzLmZvckVhY2goKHByb3BOYW1lKSA9PiB7XG4gICAgICBpZiAoIVBST1BTX09CSltwcm9wTmFtZV0pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBQQUNLQUdFICR7UEFDS0FHRX0gLT4gUmVxdWlyZWQgRGVwZW5kZW5jeSAke3Byb3BOYW1lfSBpcyBtaXNzaW5nYClcbiAgICAgIH1cbiAgICB9KVxuICB9LFxuICBpc0VtcHR5QXJyYXkgKGFycmF5KSB7XG4gICAgcmV0dXJuICghYXJyYXkgfHwgIWFycmF5Lmxlbmd0aClcbiAgfSxcbiAgYWRkT2JqZWN0Q29sdW1uOiBmdW5jdGlvbiAob2JqZWN0c0FycmF5LCBjb2x1bW5OYW1lLCB2YWx1ZXNBcnJheSkge1xuICAgIHZhciBhZGRDb2x1bXMgPSAodmFsLCBpbmRleCkgPT4gUi5tZXJnZSh7XG4gICAgICBbY29sdW1uTmFtZV06IHZhbHVlc0FycmF5W2luZGV4XVxuICAgIH0sIHZhbClcbiAgICByZXR1cm4gUi5hZGRJbmRleChSLm1hcCkoYWRkQ29sdW1zLCBvYmplY3RzQXJyYXkpXG4gIH1cblxufVxuIl19