'use strict';

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var R = require('ramda');
var fs = require('fs');
var path = require('path');
var deref = require('json-schema-deref-sync');
var normalise = require('ajv-error-messages');
var ajv = require('ajv')({ allErrors: true });
var LOG = console;
var sourceMapSupport = require('source-map-support');
sourceMapSupport.install();
var PACKAGE = 'jesus';

module.exports = {
  getAllServicesConfigFromDir: function getAllServicesConfigFromDir(dir) {
    var fileName = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'api.json';

    var services = {};
    fs.readdirSync(dir).forEach(function (file) {
      var filePath = path.join(dir, file, fileName);
      if (fs.existsSync(filePath)) services[file] = require(filePath);
    });
    // LOG.debug("getAllServicesConfigFromDir",services)
    return services;
  },
  validateApiFromConfig: function validateApiFromConfig(apiConfigFile, apiMethod, data, schemaField) {
    // TO FIX ADD CACHE
    var apiConfigPath = path.dirname(apiConfigFile) + '/';
    var apiConfig = require(apiConfigFile);
    if (!apiConfig || !apiConfig[apiMethod] || !apiConfig[apiMethod][schemaField]) throw 'Api validation problem :' + apiMethod + ' ' + schemaField + ' in ' + apiConfigFile;
    var schema = deref(apiConfig[apiMethod][schemaField], { baseFolder: apiConfigPath, failOnMissing: true });
    LOG.debug(PACKAGE, 'validateApiFromConfig schema', { apiConfig: apiConfig, apiMethod: apiMethod, schemaField: schemaField, apiConfigPath: apiConfigPath, schema: schema });
    var validate = ajv.compile(schema);
    var valid = validate(data);

    if (!valid) {
      LOG.debug(PACKAGE, 'validate.errors', normalise(validate.errors));
      throw normalise(validate.errors);
    }
    return data;
  },

  getAsPromise: function getAsPromise(value) {
    return new Promise(function (resolve, reject) {
      Promise.resolve(value).then(function (value) {
        if (typeof value === 'function') {
          try {
            resolve(value());
          } catch (error) {
            reject(error);
          }
        } else resolve(value);
      });
    });
  },
  argsOverwrite: function argsOverwrite() {
    var overwriteArgs = Array.prototype.slice.call(arguments, 1);
    var originalPackage = arguments[0];
    var modifiedPackage = {};
    for (var i in originalPackage) {
      modifiedPackage[i] = function packageArgsOverwrite() {
        var modifiedArguments = Object.assign(arguments, overwriteArgs);
        return originalPackage[i].apply(this, modifiedArguments);
      };
    }
    return modifiedPackage;
  },
  checkRequired: function checkRequired(PROPS_OBJ, PACKAGE) {
    var propsNames = Object.keys(PROPS_OBJ);
    propsNames.forEach(function (propName) {
      if (!PROPS_OBJ[propName]) {
        throw 'PACKAGE ' + PACKAGE + ' -> Required Dependency ' + propName + ' is missing';
      }
    });
  },
  isEmptyArray: function isEmptyArray(array) {
    return !array || !array.length;
  },

  addObjectColumn: function addObjectColumn(objectsArray, columnName, valuesArray) {
    var addColums = function addColums(val, index) {
      return R.merge(_defineProperty({}, columnName, valuesArray[index]), val);
    };
    return R.addIndex(R.map)(addColums, objectsArray);
  }

};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImplc3VzLmVzNiJdLCJuYW1lcyI6WyJSIiwicmVxdWlyZSIsImZzIiwicGF0aCIsImRlcmVmIiwibm9ybWFsaXNlIiwiYWp2IiwiYWxsRXJyb3JzIiwiTE9HIiwiY29uc29sZSIsInNvdXJjZU1hcFN1cHBvcnQiLCJpbnN0YWxsIiwiUEFDS0FHRSIsIm1vZHVsZSIsImV4cG9ydHMiLCJnZXRBbGxTZXJ2aWNlc0NvbmZpZ0Zyb21EaXIiLCJkaXIiLCJmaWxlTmFtZSIsInNlcnZpY2VzIiwicmVhZGRpclN5bmMiLCJmb3JFYWNoIiwiZmlsZVBhdGgiLCJqb2luIiwiZmlsZSIsImV4aXN0c1N5bmMiLCJ2YWxpZGF0ZUFwaUZyb21Db25maWciLCJhcGlDb25maWdGaWxlIiwiYXBpTWV0aG9kIiwiZGF0YSIsInNjaGVtYUZpZWxkIiwiYXBpQ29uZmlnUGF0aCIsImRpcm5hbWUiLCJhcGlDb25maWciLCJzY2hlbWEiLCJiYXNlRm9sZGVyIiwiZmFpbE9uTWlzc2luZyIsImRlYnVnIiwidmFsaWRhdGUiLCJjb21waWxlIiwidmFsaWQiLCJlcnJvcnMiLCJnZXRBc1Byb21pc2UiLCJ2YWx1ZSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwidGhlbiIsImVycm9yIiwiYXJnc092ZXJ3cml0ZSIsIm92ZXJ3cml0ZUFyZ3MiLCJBcnJheSIsInByb3RvdHlwZSIsInNsaWNlIiwiY2FsbCIsImFyZ3VtZW50cyIsIm9yaWdpbmFsUGFja2FnZSIsIm1vZGlmaWVkUGFja2FnZSIsImkiLCJwYWNrYWdlQXJnc092ZXJ3cml0ZSIsIm1vZGlmaWVkQXJndW1lbnRzIiwiT2JqZWN0IiwiYXNzaWduIiwiYXBwbHkiLCJjaGVja1JlcXVpcmVkIiwiUFJPUFNfT0JKIiwicHJvcHNOYW1lcyIsImtleXMiLCJwcm9wTmFtZSIsImlzRW1wdHlBcnJheSIsImFycmF5IiwibGVuZ3RoIiwiYWRkT2JqZWN0Q29sdW1uIiwib2JqZWN0c0FycmF5IiwiY29sdW1uTmFtZSIsInZhbHVlc0Fy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U0FBWkEsU0FBWSxDQUFDQyxHQUFELEVBQU1DLEtBQU47QUFBQSxhQUFnQjdFLEVBQUU4RSxLQUFGLHFCQUM3QkwsVUFENkIsRUFDaEJDLFlBQVlHLEtBQVosQ0FEZ0IsR0FFN0JELEdBRjZCLENBQWhCO0FBQUEsS0FBaEI7QUFHQSxXQUFPNUUsRUFBRStFLFFBQUYsQ0FBVy9FLEVBQUVnRixHQUFiLEVBQWtCTCxTQUFsQixFQUE2QkgsWUFBN0IsQ0FBUDtBQUNEOztBQWhFYyxDQUFqQiIsImZpbGUiOiJqZXN1cy5lczYiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBSID0gcmVxdWlyZSgncmFtZGEnKVxuY29uc3QgZnMgPSByZXF1aXJlKCdmcycpXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpXG52YXIgZGVyZWYgPSByZXF1aXJlKCdqc29uLXNjaGVtYS1kZXJlZi1zeW5jJylcbnZhciBub3JtYWxpc2UgPSByZXF1aXJlKCdhanYtZXJyb3ItbWVzc2FnZXMnKVxudmFyIGFqdiA9IHJlcXVpcmUoJ2FqdicpKHthbGxFcnJvcnM6IHRydWV9KVxudmFyIExPRyA9IGNvbnNvbGVcbnZhciBzb3VyY2VNYXBTdXBwb3J0ID0gcmVxdWlyZSgnc291cmNlLW1hcC1zdXBwb3J0JylcbnNvdXJjZU1hcFN1cHBvcnQuaW5zdGFsbCgpXG5jb25zdCBQQUNLQUdFID0gJ2plc3VzJ1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgZ2V0QWxsU2VydmljZXNDb25maWdGcm9tRGlyIChkaXIsIGZpbGVOYW1lID0gJ2FwaS5qc29uJykge1xuICAgIHZhciBzZXJ2aWNlcyA9IHt9XG4gICAgZnMucmVhZGRpclN5bmMoZGlyKS5mb3JFYWNoKGZpbGUgPT4ge1xuICAgICAgY29uc3QgZmlsZVBhdGggPSBwYXRoLmpvaW4oZGlyLCBmaWxlLCBmaWxlTmFtZSlcbiAgICAgIGlmIChmcy5leGlzdHNTeW5jKGZpbGVQYXRoKSlzZXJ2aWNlc1tmaWxlXSA9IHJlcXVpcmUoZmlsZVBhdGgpXG4gICAgfSlcbiAgICAvLyBMT0cuZGVidWcoXCJnZXRBbGxTZXJ2aWNlc0NvbmZpZ0Zyb21EaXJcIixzZXJ2aWNlcylcbiAgICByZXR1cm4gc2VydmljZXNcbiAgfSxcblxuICB2YWxpZGF0ZUFwaUZyb21Db25maWcgKGFwaUNvbmZpZ0ZpbGUsIGFwaU1ldGhvZCwgZGF0YSwgc2NoZW1hRmllbGQpIHtcbiAgICAgIC8vIFRPIEZJWCBBREQgQ0FDSEVcbiAgICB2YXIgYXBpQ29uZmlnUGF0aCA9IHBhdGguZGlybmFtZShhcGlDb25maWdGaWxlKSArICcvJ1xuICAgIHZhciBhcGlDb25maWcgPSByZXF1aXJlKGFwaUNvbmZpZ0ZpbGUpXG4gICAgaWYgKCFhcGlDb25maWcgfHwgIWFwaUNvbmZpZ1thcGlNZXRob2RdIHx8ICFhcGlDb25maWdbYXBpTWV0aG9kXVtzY2hlbWFGaWVsZF0pIHRocm93IGBBcGkgdmFsaWRhdGlvbiBwcm9ibGVtIDoke2FwaU1ldGhvZH0gJHtzY2hlbWFGaWVsZH0gaW4gJHthcGlDb25maWdGaWxlfWBcbiAgICB2YXIgc2NoZW1hID0gZGVyZWYoYXBpQ29uZmlnW2FwaU1ldGhvZF1bc2NoZW1hRmllbGRdLCB7YmFzZUZvbGRlcjogYXBpQ29uZmlnUGF0aCwgZmFpbE9uTWlzc2luZzogdHJ1ZX0pXG4gICAgTE9HLmRlYnVnKFBBQ0tBR0UsICd2YWxpZGF0ZUFwaUZyb21Db25maWcgc2NoZW1hJywge2FwaUNvbmZpZywgYXBpTWV0aG9kLCBzY2hlbWFGaWVsZCwgYXBpQ29uZmlnUGF0aCwgc2NoZW1hfSlcbiAgICB2YXIgdmFsaWRhdGUgPSBhanYuY29tcGlsZShzY2hlbWEpXG4gICAgdmFyIHZhbGlkID0gdmFsaWRhdGUoZGF0YSlcblxuICAgIGlmICghdmFsaWQpIHtcbiAgICAgIExPRy5kZWJ1ZyhQQUNLQUdFLCAndmFsaWRhdGUuZXJyb3JzJywgbm9ybWFsaXNlKHZhbGlkYXRlLmVycm9ycykpXG4gICAgICB0aHJvdyBub3JtYWxpc2UodmFsaWRhdGUuZXJyb3JzKVxuICAgIH1cbiAgICByZXR1cm4gZGF0YVxuICB9LFxuICBnZXRBc1Byb21pc2U6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIGlmICh0eXBlb2YgKHZhbHVlKSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIHRyeSB7IHJlc29sdmUodmFsdWUoKSkgfSBjYXRjaCAoZXJyb3IpIHsgcmVqZWN0KGVycm9yKSB9XG4gICAgICAgIH0gZWxzZSByZXNvbHZlKHZhbHVlKVxuICAgICAgfSlcbiAgICB9KVxuICB9LFxuICBhcmdzT3ZlcndyaXRlICgpIHtcbiAgICB2YXIgb3ZlcndyaXRlQXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSlcbiAgICB2YXIgb3JpZ2luYWxQYWNrYWdlID0gYXJndW1lbnRzWzBdXG4gICAgdmFyIG1vZGlmaWVkUGFja2FnZSA9IHt9XG4gICAgZm9yICh2YXIgaSBpbiBvcmlnaW5hbFBhY2thZ2UpIHtcbiAgICAgIG1vZGlmaWVkUGFja2FnZVtpXSA9IGZ1bmN0aW9uIHBhY2thZ2VBcmdzT3ZlcndyaXRlICgpIHtcbiAgICAgICAgdmFyIG1vZGlmaWVkQXJndW1lbnRzID0gT2JqZWN0LmFzc2lnbihhcmd1bWVudHMsIG92ZXJ3cml0ZUFyZ3MpXG4gICAgICAgIHJldHVybiBvcmlnaW5hbFBhY2thZ2VbaV0uYXBwbHkodGhpcywgbW9kaWZpZWRBcmd1bWVudHMpXG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBtb2RpZmllZFBhY2thZ2VcbiAgfSxcbiAgY2hlY2tSZXF1aXJlZCAoUFJPUFNfT0JKLCBQQUNLQUdFKSB7XG4gICAgdmFyIHByb3BzTmFtZXMgPSBPYmplY3Qua2V5cyhQUk9QU19PQkopXG4gICAgcHJvcHNOYW1lcy5mb3JFYWNoKChwcm9wTmFtZSkgPT4ge1xuICAgICAgaWYgKCFQUk9QU19PQkpbcHJvcE5hbWVdKSB7XG4gICAgICAgIHRocm93IGBQQUNLQUdFICR7UEFDS0FHRX0gLT4gUmVxdWlyZWQgRGVwZW5kZW5jeSAke3Byb3BOYW1lfSBpcyBtaXNzaW5nYFxuICAgICAgfVxuICAgIH0pXG4gIH0sXG4gIGlzRW1wdHlBcnJheSAoYXJyYXkpIHtcbiAgICByZXR1cm4gKCFhcnJheSB8fCAhYXJyYXkubGVuZ3RoKVxuICB9LFxuICBhZGRPYmplY3RDb2x1bW46IGZ1bmN0aW9uIChvYmplY3RzQXJyYXksIGNvbHVtbk5hbWUsIHZhbHVlc0FycmF5KSB7XG4gICAgdmFyIGFkZENvbHVtcyA9ICh2YWwsIGluZGV4KSA9PiBSLm1lcmdlKHtcbiAgICAgIFtjb2x1bW5OYW1lXTogdmFsdWVzQXJyYXlbaW5kZXhdXG4gICAgfSwgdmFsKVxuICAgIHJldHVybiBSLmFkZEluZGV4KFIubWFwKShhZGRDb2x1bXMsIG9iamVjdHNBcnJheSlcbiAgfVxuXG59XG4iXX0=